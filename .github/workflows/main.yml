name: Build U-Boot QEMU ARM64 (Splash mặc định)

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-uboot:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Install build dependencies
      run: |
        sudo apt update
        sudo apt install -y gcc-aarch64-linux-gnu make bison flex libssl-dev

    - name: Clone U-Boot
      run: |
        git clone https://source.denx.de/u-boot/u-boot.git
        cd u-boot

        # Set config for QEMU ARM64 board
        make qemu_arm64_defconfig

        # Enable splash screen (mặc định, không cần ảnh ngoài)
        echo "CONFIG_VIDEO=y" >> .config
        echo "CONFIG_DM_VIDEO=y" >> .config
        echo "CONFIG_VIDEO_LOGO=y" >> .config
        echo "CONFIG_SYS_WHITE_ON_BLACK=y" >> .config
        echo "CONFIG_SPLASH_SCREEN=y" >> .config

        make olddefconfig
        make -j$(nproc) CROSS_COMPILE=aarch64-linux-gnu-

    - name: Save build output
      run: |
        mkdir -p output
        cp u-boot/u-boot.bin output/

    - name: Upload bootloader artifact
      uses: actions/upload-artifact@v4
      with:
        name: u-boot-splash-default
        path: output/
